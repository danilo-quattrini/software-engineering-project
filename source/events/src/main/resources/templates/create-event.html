<!DOCTYPE html>
<html lang="it" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <meta name="_csrf" th:content="${_csrf.token}"/>
    <meta name="_csrf_header" th:content="${_csrf.headerName}"/>
    <title>Crea evento</title>
    <link rel="stylesheet" th:href="@{/css/app.css}"/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
            crossorigin=""></script>
</head>
<body>

<div class="layout layout--wide">
    <header class="page-header">
        <h1 class="page-title">Crea un nuovo evento</h1>
        <p class="page-subtitle">
            Compila il modulo per pubblicare un nuovo evento.
        </p>
    </header>

    <div th:if="${errorMessage}" class="alert alert--error" th:text="${errorMessage}"></div>
    <div th:if="${successMessage}" class="alert alert--success" th:text="${successMessage}"></div>

    <section class="card">
        <div class="card__header">
            <h2 class="card__title">Dettagli evento</h2>
            <p class="card__description">
                Inserisci tutte le informazioni richieste.
            </p>
        </div>

        <form th:action="@{/christian/events/new}" method="post" class="form-grid">
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}"/>

            <div class="form-field">
                <label for="title">Titolo</label>
                <input id="title" name="title" type="text" required placeholder="Titolo dell'evento"/>
            </div>

            <div class="form-field form-field--wide">
                <label for="description">Descrizione</label>
                <textarea id="description" name="description" rows="3" required
                          placeholder="Descrivi l'evento e gli obiettivi"></textarea>
            </div>

            <div class="form-field">
                <label for="type">Tipologia</label>
                <select id="type" name="type" required>
                    <option value="" disabled selected>Seleziona</option>
                    <option th:each="type : ${eventTypes}" th:value="${type}" th:text="${type}"></option>
                </select>
            </div>

            <div class="form-field form-field--wide map-field">
                <div class="map-field__header">
                    <label for="map">Mappa posizione</label>
                    <p class="map-hint">Clicca sulla mappa o cerca un indirizzo per impostare il punto dell'evento.</p>
                </div>
                <div class="map-field__container">
                    <div id="map" class="map-field__canvas"></div>
                </div>
            </div>

            <!-- Hidden fields per la Location -->
            <input type="hidden" id="lat" name="lat">
            <input type="hidden" id="lng" name="lng">
            <input type="hidden" id="locationName" name="locationName">

            <div class="form-field">
                <label for="startDateTime">Data e ora inizio</label>
                <input id="startDateTime" name="startDateTime" type="datetime-local" required/>
            </div>

            <div class="form-field">
                <label for="endDateTime">Data e ora fine</label>
                <input id="endDateTime" name="endDateTime" type="datetime-local" required/>
            </div>

            <div class="form-field">
                <label for="price">Prezzo (â‚¬)</label>
                <input id="price" name="price" type="number" min="0" step="0.01" required placeholder="0.00"/>
            </div>

            <div class="form-actions form-actions--right">
                <a th:href="@{/events}" class="button button--ghost">Annulla</a>
                <button type="submit" class="button">Crea evento</button>
            </div>
        </form>
    </section>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
        integrity="sha256-vxo9QF3vjuFQFZr+MYg2tY2mHv1lHVZ9d2XpypY4q0M=" crossorigin=""></script>

<script type="module">
    import MapComponent from '/js/osm/map-component.js';
    import { addEventLocationOnClick } from '/js/osm/modules/event-location/addEventLocationOnClick.js';
    import { addEventLocationByAddress } from '/js/osm/modules/event-location/addEventLocationByAddress.js';
    import { loadEventsMarkers } from '/js/osm/modules/event-location/loadEventsMarkers.js';

    const map = new MapComponent('map', {
        center: [41.9028, 12.4964],
        zoom: 6
    });

    map.use(loadEventsMarkers);
    map.use(addEventLocationOnClick);
    map.use(addEventLocationByAddress);
</script>

</body>
</html>
